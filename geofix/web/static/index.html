<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeoFix ‚Äî Chat</title>
  <meta name="description" content="GeoFix AI Chat ‚Äî fix geospatial data with conversational AI." />
  <link rel="icon" href="/public/img/favicon.png" type="image/png" />
  <link rel="stylesheet" href="/static/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>

<body>
  <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <aside id="sidebar" class="sidebar open">
    <!-- Workspace header -->
    <div class="sidebar-header">
      <div class="workspace-row">
        <a href="/" class="logo-row" title="Back to Home">
          <img src="/public/avatars/logo_orange.svg" alt="GeoFix" class="logo-icon" />
          <span class="logo-text">Home Workspace</span>
        </a>
        <button id="btn-workspace-settings" class="icon-btn" title="Workspace Settings">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
          </svg>
        </button>
      </div>
      <button id="sidebar-close" class="icon-btn" title="Close sidebar (Ctrl+B)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" />
          <line x1="9" y1="3" x2="9" y2="21" />
          <polyline points="16 15 13 12 16 9" />
        </svg>
      </button>
    </div>

    <button id="btn-new-chat" class="btn-new-chat">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19" />
        <line x1="5" y1="12" x2="19" y2="12" />
      </svg>
      New Chat
    </button>

    <div class="sidebar-search">
      <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2">
        <circle cx="11" cy="11" r="8" />
        <line x1="21" y1="21" x2="16.65" y2="16.65" />
      </svg>
      <input id="search-input" type="text" placeholder="Search chats..." />
    </div>

    <div class="conv-section-label">Recent Chats</div>
    <div id="conversations-list" class="conversations-list"></div>

    <div class="sidebar-footer">
      <div class="user-profile" id="user-profile-btn" role="button" tabindex="0" title="User Settings">
        <div class="user-avatar" id="sidebar-avatar">
          <img src="/public/avatars/logo_orange.svg" alt="User">
        </div>
        <div class="user-info">
          <div class="user-name" id="sidebar-username">Guest</div>
          <div class="user-status">Free Plan</div>
        </div>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          style="margin-left: auto; color: var(--text-muted);">
          <circle cx="12" cy="12" r="3"></circle>
          <path
            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" />
        </svg>
      </div>
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ Sidebar Overlay (mobile) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="sidebar-overlay" class="sidebar-overlay"></div>

  <!-- ‚îÄ‚îÄ Main Chat Area ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <main id="main" class="main">
    <!-- Top bar -->
    <header class="topbar">
      <button id="sidebar-open" class="icon-btn" title="Open sidebar (Ctrl+B)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" />
          <line x1="9" y1="3" x2="9" y2="21" />
          <polyline points="14 9 17 12 14 15" />
        </svg>
      </button>
      <div class="topbar-title">
        <span id="topbar-label">New Chat</span>
      </div>
      <div class="topbar-right">
        <button id="theme-toggle" class="icon-btn topbar-social" title="Toggle Theme">
          <svg class="theme-moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
          <svg class="theme-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" style="display:none">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
        <a href="mailto:ammaryasr522@gmail.com" class="icon-btn topbar-social" title="Report a Problem">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </a>
        <a href="https://github.com/AmmarYasser455/GeoFix" target="_blank" class="icon-btn topbar-social"
          title="GitHub">
          <svg width="17" height="17" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
          </svg>
        </a>
        <a href="https://x.com/Ammar12274191" target="_blank" class="icon-btn topbar-social" title="X (Twitter)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
          </svg>
        </a>
      </div>
    </header>

    <!-- Welcome screen -->
    <div id="welcome-screen" class="welcome-screen">
      <img src="/public/favicon.png" alt="GeoFix" class="welcome-logo" />
      <h1 class="welcome-title">GeoFix</h1>
      <p class="welcome-subtitle">AI-Powered Geospatial Data Correction</p>

      <div class="starters-grid">
        <button class="starter-btn"
          data-message="Profile my data quality ‚Äî check CRS, validity, duplicates, and feature statistics.">
          <span class="starter-icon">üìä</span>
          <span class="starter-label">Profile My Data</span>
          <span class="starter-desc">Check CRS, validity, and quality</span>
        </button>
        <button class="starter-btn"
          data-message="Run the full quality check pipeline ‚Äî detect overlaps, boundary violations, invalid geometries, and road conflicts.">
          <span class="starter-icon">üîç</span>
          <span class="starter-label">Detect Errors</span>
          <span class="starter-desc">Find overlaps and invalid geometries</span>
        </button>
        <button class="starter-btn"
          data-message="Detect all errors and automatically fix what you can. Show me the results.">
          <span class="starter-icon">üîß</span>
          <span class="starter-label">Auto-Fix Everything</span>
          <span class="starter-desc">Detect and repair all issues</span>
        </button>
        <button class="starter-btn"
          data-message="What are your capabilities? Give me a quick overview of what GeoFix can help with.">
          <span class="starter-icon">üí°</span>
          <span class="starter-label">What Can You Do?</span>
          <span class="starter-desc">Overview of GeoFix features</span>
        </button>
      </div>
    </div>

    <!-- Messages area -->
    <div id="messages" class="messages"></div>

    <!-- Typing indicator -->
    <div id="typing-indicator" class="typing-indicator" hidden>
      <div class="typing-content">
        <div class="typing-avatar"><img src="/public/favicon.png" alt="GeoFix" /></div>
        <div class="typing-dots"><span></span><span></span><span></span></div>
      </div>
    </div>

    <!-- Input area -->
    <div class="input-area">
      <div class="input-container">
        <label id="file-upload-btn" class="file-upload-btn" title="Upload file (SHP, GeoJSON, GPKG)">
          <input type="file" id="file-input" accept=".shp,.shx,.dbf,.prj,.geojson,.json,.gpkg,.gml,.kml,.zip" multiple
            hidden />
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path
              d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
          </svg>
        </label>
        <textarea id="message-input" rows="1" placeholder="Ask GeoFix anything..." autofocus></textarea>
        <!-- Model chip -->
        <div class="model-chip-wrapper">
          <select id="model-select" class="model-chip" title="Select model">
            <option value="auto" selected>Auto</option>
            <option value="llama3.2">Speed</option>
            <option value="llama3.1:latest">Smart</option>
            <option value="deepseek-r1:14b">Deep</option>
          </select>
        </div>
        <button id="btn-send" class="btn-send" title="Send (Enter)" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13" />
            <path d="M22 2L15 22L11 13L2 9L22 2Z" />
          </svg>
        </button>
      </div>
      <div id="file-preview" class="file-preview" hidden></div>
      <p class="input-hint">GeoFix may make mistakes. Verify important results. <kbd>Ctrl+/</kbd> focus ‚Ä¢
        <kbd>Ctrl+N</kbd> new chat ‚Ä¢ <kbd>Ctrl+B</kbd> sidebar
      </p>
    </div>
  </main>

  <!-- ‚ïê‚ïê‚ïê Workspace Settings Modal ‚ïê‚ïê‚ïê -->
  <div id="modal-workspace" class="modal-overlay" hidden>
    <div class="modal-card">
      <div class="modal-header">
        <h2>Workspace Settings</h2>
        <span class="modal-subtitle">This is your home workspace for personal use.</span>
      </div>
      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="main">Main</button>
        <button class="modal-tab" data-tab="defaults">Defaults</button>
      </div>
      <div class="modal-body">
        <div id="tab-main" class="tab-pane active">
          <label class="modal-label">Workspace Name</label>
          <input type="text" id="ws-name" class="modal-input" value="Home" />
          <label class="modal-label">How would you like the AI to respond in this workspace?</label>
          <textarea id="ws-instructions" class="modal-textarea" placeholder="Instructions... (optional)"
            maxlength="1500"></textarea>
          <span id="ws-char-count" class="char-count">0/1500</span>
        </div>
        <div id="tab-defaults" class="tab-pane">
          <label class="modal-label">Default Model</label>
          <select id="ws-default-model" class="modal-input">
            <option value="auto">Auto</option>
            <option value="llama3.2">Speed (Llama 3.2)</option>
            <option value="llama3.1:latest">Smart (Llama 3.1)</option>
            <option value="deepseek-r1:14b">Deep Think</option>
          </select>
          <label class="modal-label">Default Temperature</label>
          <input type="range" id="ws-temperature" min="0" max="1" step="0.1" value="0.7" class="modal-range" />
          <span id="ws-temp-value" class="range-value">0.7</span>
        </div>
      </div>
      <div class="modal-footer">
        <button id="ws-cancel" class="modal-btn cancel">Cancel</button>
        <button id="ws-save" class="modal-btn save">Save</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê User Settings Modal ‚ïê‚ïê‚ïê -->
  <div id="modal-settings" class="modal-overlay" hidden>
    <div class="modal-card">
      <div class="modal-header">
        <h2>User Settings</h2>
        <span class="modal-subtitle">Configure your API keys and preferences.</span>
      </div>
      <div class="modal-body">
        <label class="modal-label">Gemini API Key</label>
        <div class="api-key-row">
          <input type="password" id="setting-api-key" class="modal-input" placeholder="Enter your Gemini API key..." />
          <button id="toggle-api-key" class="icon-btn" title="Show/Hide">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
              <circle cx="12" cy="12" r="3" />
            </svg>
          </button>
        </div>
        <p class="modal-hint">Your API key is stored locally in your browser. It is never sent to any external server.
        </p>

        <label class="modal-label" style="margin-top:16px">Display Name</label>
        <input type="text" id="setting-display-name" class="modal-input" placeholder="Your name..." />
      </div>
      <div class="modal-footer">
        <button id="settings-cancel" class="modal-btn cancel">Cancel</button>
        <button id="settings-save" class="modal-btn save">Save</button>
      </div>
    </div>
  </div>

  <script src="/static/app.js"></script>
</body>

</html>